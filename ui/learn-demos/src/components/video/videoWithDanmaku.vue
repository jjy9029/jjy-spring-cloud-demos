<template>
<!--  <video src="@/assets/video/test.mp4"  controls>-->
<!--  </video>-->
  <Danmaku
      ref="danmaku"
      class="danmaku-normal"
      :danmus="[]"
      :speeds="130"
      :channels="1"
      :loop="false"
      :top="20"
      :right="50"
      :is-suspend="true"
      :use-slot="true"
      :useSuspendSlot="true"
  >
<!--    ËøôÈáåÂØπDanmakuÁöÑÂèÇÊï∞ËøõË°åËß£Èáä
    ref="danmaku"  ÂºπÂπïÁªÑ‰ª∂ÁöÑÂºïÁî®
    class="danmaku-normal"  ÂºπÂπïÁªÑ‰ª∂ÁöÑÊ†∑Âºè
    :danmus="[]"  ÂºπÂπïÊï∞ÁªÑÔºåËøôÈáå‰∏∫Á©∫ÔºåÂêéÈù¢ÈÄöËøáÊâãÂä®addÂáΩÊï∞ÂéªÂÆûÁé∞Âª∂Êó∂Âä†ËΩΩÊØèÊù°ÂºπÂπï
    :speeds="130"  ÂºπÂπïÈÄüÂ∫¶ÔºåËøôÈáå‰∏∫130ÔºåÂç≥130msÂèëÈÄÅ‰∏ÄÊ¨°ÂºπÂπï
    :channels="1"  ÂºπÂπïÈÄöÈÅìÔºåËøôÈáå‰∏∫1ÔºåÂç≥ÂçïÈÄöÈÅì
    :loop="false"  ÊòØÂê¶Âæ™ÁéØÊí≠ÊîæÔºåËøôÈáå‰∏∫false
    :top="20"  ÂºπÂπïÁ∫µÂêëÈó¥ÈöîÔºåËøôÈáå‰∏∫20px
    :right="50"  ÂºπÂπïÊ®™ÂêëÈó¥ÈöîÔºåËøôÈáå‰∏∫50px
    :is-suspend="true"  ÊòØÂê¶ÊòæÁ§∫ÊÇ¨ÂÅúÂºπÂπïÔºåËøôÈáå‰∏∫true
    :use-slot="true"  ÊòØÂê¶‰ΩøÁî®Ëá™ÂÆö‰πâÂºπÂπïÂÜÖÂÆπÔºåËøôÈáå‰∏∫true
    :useSuspendSlot="true"  ÊòØÂê¶‰ΩøÁî®Ëá™ÂÆö‰πâÊÇ¨ÂÅúÂºπÂπïÂÜÖÂÆπÔºåËøôÈáå‰∏∫true
-->
    <!--  Ëá™ÂÆö‰πâÂºπÂπïÁöÑÊòæÁ§∫ÂÜÖÂÆπ  -->
    <template #dm="{ danmu,index }">
      <div>
        <div>{{ danmu.content }}</div>
      </div>
    </template>

    <!--  Ëá™ÂÆö‰πâÂºπÂπïÊÇ¨ÂÅúÂÜÖÂÆπ  Ëøô‰∫õÂÜÖÂÆπ‰ºöÂä†Âú®ÂºπÂπïÁöÑÂêéÈù¢ -->
    <template #suspend="{ danmu, index }" >
      <div class="danmu-suspend">
        <div>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          +1</div>
        <div> üëç</div>
      </div>
    </template>
  </Danmaku>


  <button @click="addDanmake">click-here</button>
</template>
<script setup>
import Danmaku from 'danmaku-vue'
import {ref, onMounted,defineProps} from "vue";


const danmus = ref([])
danmus.value = [
  {content: 'ÂºπÂπïÂ§ßÂÜõÊù•‰∫Ü', time: 0}
]
const dam =     [
    {content: 'danmu1', time: 3000},
        {content: 'danmu2', time: 5000},
        {content: 'danmu3', time: 7000},
        {content: 'danmu4', time: 1000},
        {content: 'danmu5', time: 9000}
    ]
dam.forEach(item=>{
  danmus.value.push(item)
})


//  ÂØπÂºπÂπïÁöÑÊìç‰ΩúÂáΩÊï∞
const danmaku = ref(null)
const addDanmake = () => {
  danmus.value.push({content: 'ÂºπÂπï',time:10000})
  danmaku.value.add({content: 'ÂºπÂπï',time:10000})
  console.log(danmaku.value)
}
const danmakuPause = () => {
  danmaku.value.pause()
}
const danmakuContinue = () => {
  danmaku.value.play()
}

// Âõ†‰∏∫DanmakuÁªÑ‰ª∂ÊòæÁ§∫ÁöÑÂºπÂπï‰∏çËÉΩÂÅöÂà∞ÂíåËßÜÈ¢ëÂêåÊ≠•ÔºåÊâÄ‰ª•ÊâãÂä®Âª∂Êó∂Âä†ÂÖ•Âà∞ÂºπÂπïÈòüÂàó‰∏≠Ôºå
// Âª∂Êó∂‰∏∫ÂèëÈÄÅÂºπÂπïÁöÑÊó∂Èó¥‰∏éËßÜÈ¢ëÁöÑÂºÄÂßãÊí≠ÊîæÊó∂Èó¥ÁöÑÂ∑ÆÂÄºÔºåËÆ∞ÂΩïÂ∑ÆÂÄº‰∫éÊï∞ÊçÆÂ∫ìÔºåÂàôÂà∑Êñ∞‰πãÂêéÊñ∞ÁöÑÂºπÂπïÂá∫Áé∞Âú®ÂØπÂ∫îÁöÑÊó∂Èó¥ÁÇπ„ÄÇ
 const  video = ref(null)
const delayDanmaku = ()=>{
    let startTime  =  videoBeginTime
    let playTime  = video.value.time
    let tempArr = [];
    danmus.value.filter((item,index)=>{
      return item.time <= playTime && !tempArr.includes(item.id)
    }).forEach((item,index)=>{
      tempArr.push(item.id)
      danmaku.value.add(item.content)
    })

    let intervalCheck = setInterval(()=>{
      if (tempArr.length == danmus.value.length){
        clearInterval(intervalCheck)
      }
    },100)
}

const visibleDanmus = ref([]);
onMounted(() => {
  let startTime = Date.now();
  let intervalId = setInterval(() => {
    const currentTime = Date.now() - startTime;
    const newDanmus = danmus.value.filter(danmu => danmu.time <= currentTime && !visibleDanmus.value.includes(danmu));
    newDanmus.forEach(danmu => {
      console.log(danmu)
      danmaku.value.add(danmu)
      visibleDanmus.value.push(danmu)
    });
    if (visibleDanmus.value.length === danmus.value.length) {
      clearInterval(intervalId);
    }
  }, 100);
})
</script>


<style scoped>
.danmaku-normal {
  width: 500px;
  height: 500px;
  border: 2px solid black;
  opacity: 1;
  position: relative;
}

.danmaku-large {

}

</style>


<!--
ÂÆâË£Ö danmaku
npm install danmaku-vue --save
-->

